import sys
import signal
from scapy.all import *
from scapy.error import Scapy_Exception

def ctrlc_handler(signum, frm):
        sys.exit(0)

def parse(pkt):
	if pkt[0].haslayer(TCP) and pkt[0].getlayer(TCP).dport == 80 and pkt[0].haslayer(Raw):
		print "Request from " + pkt[0].getlayer(IP).src
		headers =  pkt[0].getlayer(Raw).load
		header_lines = headers.split("\n")
		for h in header_lines:
			if 'post /' in h.lower():
				print "POST request: " + h[5:len(h)-10]
			elif 'get /' in h.lower():
				print "GET request: " + h[4:len(h)-10]
			elif 'Host:' in h:
                                print h
			elif 'User-Agent:' in h:
                                print h

signal.signal(signal.SIGINT, ctrlc_handler)

while 1:
	pkt = sniff(iface="eth1", filter="tcp", count=1)
	parse(pkt)

